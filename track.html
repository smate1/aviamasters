<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π - AVIAMASTERS</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-attachment: fixed;
      color: #333;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      color: #333;
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .stats-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #00ff88, #00cc66);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 30px;
      align-items: center;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .btn-danger {
      background: #ff4757;
      color: white;
    }

    .btn-danger:hover {
      background: #ff3742;
      transform: translateY(-2px);
    }

    .btn-success {
      background: #2ed573;
      color: white;
    }

    .btn-success:hover {
      background: #1dd1a1;
      transform: translateY(-2px);
    }

    .btn-info {
      background: #5352ed;
      color: white;
    }

    .btn-info:hover {
      background: #3742fa;
      transform: translateY(-2px);
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filter-group label {
      font-weight: bold;
      color: #555;
    }

    .filter-group select {
      padding: 8px 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      background: white;
      cursor: pointer;
    }

    .table-container {
      overflow-x: auto;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th,
    td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    th {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      font-weight: bold;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    tr:hover {
      background-color: #f8f9fa;
    }

    .device-mobile {
      color: #ff6b6b;
    }

    .device-desktop {
      color: #4ecdc4;
    }

    .ip-cell {
      font-family: monospace;
      font-weight: bold;
      color: #333;
    }

    .country-cell {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .country-flag {
      font-size: 1.2rem;
    }

    .time-cell {
      font-size: 0.9rem;
      color: #666;
    }

    .action-cell {
      font-size: 0.9rem;
      padding: 4px 8px;
      border-radius: 4px;
      background: #f1f2f6;
      display: inline-block;
    }

    .action-visit {
      background: #3742fa;
      color: white;
    }

    .action-click {
      background: #2ed573;
      color: white;
    }

    .action-event {
      background: #ff6348;
      color: white;
    }

    .no-data {
      text-align: center;
      padding: 40px;
      color: #666;
      font-style: italic;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .source-cell {
      max-width: 200px;
      word-wrap: break-word;
      font-size: 0.85rem;
      color: #666;
      line-height: 1.3;
    }

    .source-direct {
      color: #28a745;
      font-weight: bold;
    }

    .source-search {
      color: #007bff;
    }

    .source-social {
      color: #e83e8c;
    }

    .source-unknown {
      color: #6c757d;
      font-style: italic;
    }

    .export-info {
      margin-top: 20px;
      padding: 15px;
      background: rgba(52, 152, 219, 0.1);
      border-left: 4px solid #3498db;
      border-radius: 4px;
      font-size: 0.9rem;
      color: #555;
    }

    @media (max-width: 768px) {
      .container {
        padding: 20px;
        margin: 10px;
      }

      .header h1 {
        font-size: 2rem;
      }

      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .btn {
        justify-content: center;
      }

      table {
        font-size: 0.9rem;
      }

      th,
      td {
        padding: 8px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π</h1>
      <p>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ AVIAMASTERS</p>
      <div
        style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px; padding: 10px; margin: 15px 0; font-size: 14px;">
        <strong>üåê –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞:</strong> –î–∞–Ω—ñ –∑–±–∏—Ä–∞—é—Ç—å—Å—è –∑ —É—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
        <span id="syncStatus" style="margin-left: 10px; padding: 2px 8px; border-radius: 4px; font-size: 12px;"></span>
      </div>
    </div>

    <div class="stats-summary">
      <div class="stat-card">
        <div class="stat-value" id="uniqueIPs">0</div>
        <div class="stat-label">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalRecords">0</div>
        <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="todayVisits">0</div>
        <div class="stat-label">–°–µ–≥–æ–¥–Ω—è</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="uniqueCountries">0</div>
        <div class="stat-label">–°—Ç—Ä–∞–Ω</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalClicks">0</div>
        <div class="stat-label">–ö–ª–∏–∫–æ–≤</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="uniqueSources">0</div>
        <div class="stat-label">–ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤</div>
      </div>
    </div>

    <div class="controls">
      <button class="btn btn-danger" onclick="clearLogs()">
        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
      </button>
      <button class="btn btn-success" onclick="downloadCSV()">
        üì• –°–∫–∞—á–∞—Ç—å CSV
      </button>
      <button class="btn btn-info" onclick="downloadJSON()">
        üìã –°–∫–∞—á–∞—Ç—å JSON
      </button>
      <button class="btn btn-info" onclick="refreshData()">
        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
      </button>
      <button class="btn btn-success" onclick="showDebugInfo()">
        üîç –û—Ç–ª–∞–¥–∫–∞
      </button>
      <button class="btn btn-info" onclick="syncWithServer()">
        üåê –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
      </button>
      <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData()">
      <button class="btn btn-info" onclick="document.getElementById('importFile').click()">
        üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
      </button>

      <div class="filter-group">
        <label for="countryFilter">–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç—Ä–∞–Ω–µ:</label>
        <select id="countryFilter" onchange="filterTable()">
          <option value="">–í—Å–µ</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="typeFilter">–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:</label>
        <select id="typeFilter" onchange="filterTable()">
          <option value="">–í—Å–µ</option>
          <option value="visit">–ü–æ—Å–µ—â–µ–Ω–∏—è</option>
          <option value="click">–ö–ª–∏–∫–∏</option>
          <option value="event">–°–æ–±—ã—Ç–∏—è</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="deviceFilter">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</label>
        <select id="deviceFilter" onchange="filterTable()">
          <option value="">–í—Å–µ</option>
          <option value="Desktop">–î–µ—Å–∫—Ç–æ–ø</option>
          <option value="Mobile">–ú–æ–±–∏–ª—å–Ω—ã–π</option>
          <option value="Tablet">–ü–ª–∞–Ω—à–µ—Ç</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="uniqueFilter">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å:</label>
        <select id="uniqueFilter" onchange="filterTable()">
          <option value="">–í—Å–µ</option>
          <option value="unique">–¢–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ IP</option>
          <option value="repeat">–¢–æ–ª—å–∫–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ IP</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="sourceFilter">–ò—Å—Ç–æ—á–Ω–∏–∫:</label>
        <select id="sourceFilter" onchange="filterTable()">
          <option value="">–í—Å–µ</option>
        </select>
      </div>
    </div>

    <div class="table-container">
      <table id="logTable">
        <thead>
          <tr>
            <th>IP</th>
            <th>–°—Ç—Ä–∞–Ω–∞</th>
            <th>–ì–æ—Ä–æ–¥</th>
            <th>–í—Ä–µ–º—è</th>
            <th>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</th>
            <th>–ë—Ä–∞—É–∑–µ—Ä</th>
            <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
            <th>–¢–∏–ø</th>
            <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
            <th>–î–µ—Ç–∞–ª–∏</th>
          </tr>
        </thead>
        <tbody id="logTableBody">
          <tr>
            <td colspan="10" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="export-info">
      <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥.
      –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö, –∑—ñ–±—Ä–∞–Ω–∏—Ö –∑ —É—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤.
      <br><br>
      <strong>üîß –û—Ç–ª–∞–¥–∫–∞:</strong>
      <br>‚Ä¢ –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
      <br>‚Ä¢ –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–∂–¥—É –≤—Å–µ–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
      <br>‚Ä¢ –ó–µ–ª–µ–Ω—ã–π —Å—Ç–∞—Ç—É—Å –æ–∑–Ω–∞—á–∞–µ—Ç —É—Å–ø–µ—à–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å —Å–µ—Ä–≤–µ—Ä–æ–º
      <br>‚Ä¢ –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      <br><br>
      <strong>üì± –ú—É–ª—å—Ç–∏—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</strong>
      <br>‚Ä¢ –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      <br>‚Ä¢ –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ —Ä—É—á–Ω–æ–º —ç–∫—Å–ø–æ—Ä—Ç–µ/–∏–º–ø–æ—Ä—Ç–µ
      <br>‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    </div>
  </div>

  <script>
    let allData = [];
    let filteredData = [];

    // –û—Ç—Ä–∏–º—É—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π projectId —Ç–∞ binId –¥–ª—è —Ü—å–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É
    const getProjectConfig = () => {
      const projectId = localStorage.getItem('aviamasters_project_id');
      if (!projectId) {
        console.error('‚ùå Project ID –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ! –°–ø–æ—á–∞—Ç–∫—É –≤—ñ–¥–≤—ñ–¥–∞–π—Ç–µ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É.');
        return null;
      }

      const binId = localStorage.getItem(`aviamasters_bin_id_${projectId}`);
      if (!binId) {
        console.error('‚ùå Bin ID –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ! –°–ø–æ—á–∞—Ç–∫—É –≤—ñ–¥–≤—ñ–¥–∞–π—Ç–µ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É.');
        return null;
      }

      return { projectId, binId };
    };

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —Å–µ—Ä–≤–µ—Ä–∞
    const initServerConfig = () => {
      const config = getProjectConfig();
      if (!config) {
        return {
          binId: null,
          apiKey: '$2a$10$Vu6QKl3.JJ2ZQSn.YMGQNejkOB5bF9sLj2PU1Y2zl7O8hJCZVp3Jm',
          baseUrl: 'https://api.jsonbin.io/v3/b',
          projectId: null
        };
      }

      console.log('üÜî –ü–æ—Ç–æ—á–Ω–∏–π Project ID:', config.projectId);
      console.log('üèóÔ∏è –ü–æ—Ç–æ—á–Ω–∏–π Bin ID:', config.binId);

      return {
        binId: config.binId,
        apiKey: '$2a$10$Vu6QKl3.JJ2ZQSn.YMGQNejkOB5bF9sLj2PU1Y2zl7O8hJCZVp3Jm',
        baseUrl: 'https://api.jsonbin.io/v3/b',
        projectId: config.projectId
      };
    };

    // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Å–µ—Ä–≤–µ—Ä–∞
    const serverConfig = initServerConfig();

    // –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
    function updateSyncStatus(status, message) {
      const syncStatus = document.getElementById('syncStatus');
      if (syncStatus) {
        syncStatus.textContent = message;
        if (status === 'success') {
          syncStatus.style.background = '#4caf50';
          syncStatus.style.color = 'white';
        } else if (status === 'error') {
          syncStatus.style.background = '#f44336';
          syncStatus.style.color = 'white';
        } else {
          syncStatus.style.background = '#ff9800';
          syncStatus.style.color = 'white';
        }
      }
    }

    // –û—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –∑ —Å–µ—Ä–≤–µ—Ä–∞
    async function getServerData() {
      try {
        if (!serverConfig.binId) {
          updateSyncStatus('error', '‚ùå –ù–µ–º–∞—î –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó');
          return [];
        }

        updateSyncStatus('loading', '‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...');

        const response = await fetch(`${serverConfig.baseUrl}/${serverConfig.binId}/latest`, {
          headers: {
            'X-Master-Key': serverConfig.apiKey,
          },
        });

        if (response.ok) {
          const result = await response.json();
          const serverData = result.record || { events: [], metadata: { site: 'aviamasters' } };

          // –§—ñ–ª—å—Ç—Ä—É—î–º–æ —Ç—ñ–ª—å–∫–∏ –ø–æ–¥—ñ—ó –Ω–∞—à–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É
          const projectEvents = (serverData.events || []).filter(event =>
            event.projectId === serverConfig.projectId
          );

          updateSyncStatus('success', `‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ (${projectEvents.length})`);
          return projectEvents;
        } else if (response.status === 404) {
          updateSyncStatus('error', '‚ùå –î–∞–Ω—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
          return [];
        } else {
          throw new Error(`Server returned ${response.status}`);
        }
      } catch (error) {
        console.warn('–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —Å–µ—Ä–≤–µ—Ä–∞:', error);
        updateSyncStatus('error', '‚ùå –ü–æ–º–∏–ª–∫–∞ –∑\'—î–¥–Ω–∞–Ω–Ω—è');
        return [];
      }
    }

    // –û—Ç—Ä–∏–º–∞—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ
    function getLocalData() {
      try {
        const localData = JSON.parse(localStorage.getItem('gameAnalytics') || '[]');
        console.log('–õ–æ–∫–∞–ª—å–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤:', localData.length);
        return localData;
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö:', error);
        return [];
      }
    }

    // –û–±'—î–¥–Ω–∞—Ç–∏ —Ç–∞ –æ—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ
    function mergeData(serverData, localData) {
      // –û–±'—î–¥–Ω—É—î–º–æ –¥–∞–Ω—ñ
      const allEvents = [...serverData, ...localData];

      // –í–∏–¥–∞–ª—è—î–º–æ –¥—É–±–ª—ñ–∫–∞—Ç–∏ –ø–æ sessionId + timestamp
      const uniqueEvents = [];
      const seen = new Set();

      for (const event of allEvents) {
        const key = `${event.sessionId || 'unknown'}-${event.timestamp}`;
        if (!seen.has(key)) {
          seen.add(key);
          uniqueEvents.push(event);
        }
      }

      // –°–æ—Ä—Ç—É—î–º–æ –ø–æ —á–∞—Å—É
      uniqueEvents.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

      console.log(`–û–±'—î–¥–Ω–∞–Ω–æ ${uniqueEvents.length} —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ (—Å–µ—Ä–≤–µ—Ä: ${serverData.length}, –ª–æ–∫–∞–ª—å–Ω—ñ: ${localData.length})`);
      return uniqueEvents;
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–ª–∞–≥–∞ —Å—Ç—Ä–∞–Ω—ã –ø–æ –∫–æ–¥—É
    function getCountryFlag(countryCode) {
      if (!countryCode || countryCode === 'XX') return 'üåç';

      const flags = {
        'RU': 'üá∑üá∫', 'UA': 'üá∫üá¶', 'KZ': 'üá∞üáø', 'BY': 'üáßüáæ',
        'US': 'üá∫üá∏', 'GB': 'üá¨üáß', 'DE': 'üá©üá™', 'FR': 'üá´üá∑',
        'CN': 'üá®üá≥', 'JP': 'üáØüáµ', 'KR': 'üá∞üá∑', 'IN': 'üáÆüá≥',
        'BR': 'üáßüá∑', 'CA': 'üá®üá¶', 'AU': 'üá¶üá∫', 'IT': 'üáÆüáπ',
        'ES': 'üá™üá∏', 'NL': 'üá≥üá±', 'SE': 'üá∏üá™', 'NO': 'üá≥üá¥',
        'PL': 'üáµüá±', 'TR': 'üáπüá∑', 'IL': 'üáÆüá±', 'AE': 'üá¶üá™'
      };

      return flags[countryCode] || 'üåç';
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function updateStats() {
      const uniqueIPs = new Set(allData.map(item => item.ip)).size;
      const totalRecords = allData.length;

      const today = new Date().toDateString();
      const todayVisits = allData.filter(item =>
        new Date(item.timestamp).toDateString() === today
      ).length;

      const uniqueCountries = new Set(allData.map(item => item.country)).size;

      // –ü–æ–¥—Å—á–µ—Ç –∫–ª–∏–∫–æ–≤
      const totalClicks = allData.filter(item => item.type === 'click').length;

      // –ü–æ–¥—Å—á–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
      const uniqueSources = new Set(allData.map(item => item.referrer || item.source || 'Unknown')).size;

      document.getElementById('uniqueIPs').textContent = uniqueIPs;
      document.getElementById('totalRecords').textContent = totalRecords;
      document.getElementById('todayVisits').textContent = todayVisits;
      document.getElementById('uniqueCountries').textContent = uniqueCountries;
      document.getElementById('totalClicks').textContent = totalClicks;
      document.getElementById('uniqueSources').textContent = uniqueSources;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ —Å—Ç—Ä–∞–Ω
    function updateCountryFilter() {
      const countryFilter = document.getElementById('countryFilter');
      const countries = [...new Set(allData.map(item => item.country))].sort();

      // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏ –∫—Ä–æ–º–µ "–í—Å–µ"
      countryFilter.innerHTML = '<option value="">–í—Å–µ</option>';

      countries.forEach(country => {
        if (country && country !== 'Unknown') {
          const option = document.createElement('option');
          option.value = country;
          option.textContent = country;
          countryFilter.appendChild(option);
        }
      });
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    function updateSourceFilter() {
      const sourceFilter = document.getElementById('sourceFilter');
      const sources = [...new Set(allData.map(item => item.referrer || item.source || 'Unknown'))].sort();

      // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏ –∫—Ä–æ–º–µ "–í—Å–µ"
      sourceFilter.innerHTML = '<option value="">–í—Å–µ</option>';

      sources.forEach(source => {
        if (source && source !== 'Unknown') {
          const option = document.createElement('option');
          option.value = source;
          option.textContent = source;
          sourceFilter.appendChild(option);
        }
      });
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    async function loadData() {
      try {
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
        if (!serverConfig.projectId) {
          updateSyncStatus('error', '‚ùå –í—ñ–¥–≤—ñ–¥–∞–π—Ç–µ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É');
          document.getElementById('logTableBody').innerHTML =
            '<tr><td colspan="10" class="no-data">‚ùå –°–ø–æ—á–∞—Ç–∫—É –≤—ñ–¥–≤—ñ–¥–∞–π—Ç–µ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏</td></tr>';
          return;
        }

        // –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –∑ —Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ
        const [serverData, localData] = await Promise.all([
          getServerData(),
          getLocalData()
        ]);

        // –û–±'—î–¥–Ω—É—î–º–æ –¥–∞–Ω—ñ
        allData = mergeData(serverData, localData);

        console.log('–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤:', allData.length);

        // –û–±—Ä–æ–±–ª—è—î–º–æ –¥–∞–Ω—ñ
        allData = allData.map(item => ({
          ...item,
          ip: item.ip || 'Unknown',
          country: item.country || 'Unknown',
          countryCode: item.countryCode || 'XX',
          city: item.city || 'Unknown',
          deviceType: item.deviceType || 'Unknown',
          browser: item.browser || 'Unknown',
          timestamp: item.timestamp || new Date().toISOString(),
          type: item.type || 'unknown',
          action: item.action || item.eventType || 'visit',
          details: item.details || item.action || '',
          source: item.referrer || item.source || 'Unknown'
        }));

        updateStats();
        updateCountryFilter();
        updateSourceFilter();
        filterTable();

        // –ü–æ–∫–∞–∑—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤
        if (allData.length === 0) {
          console.log('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –ø–æ—Å–µ—Ç–∏—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
          updateSyncStatus('error', '‚ùå –ù–µ–º–∞—î –¥–∞–Ω–∏—Ö');
        } else {
          console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${allData.length} –∑–∞–ø–∏—Å–µ–π`);
        }

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
        updateSyncStatus('error', '‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è');
        document.getElementById('logTableBody').innerHTML =
          '<tr><td colspan="10" class="no-data">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
      }
    }

    // –†—É—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º
    async function syncWithServer() {
      updateSyncStatus('loading', '‚è≥ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è...');
      await loadData();
    }

    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã
    function filterTable() {
      const countryFilter = document.getElementById('countryFilter').value;
      const typeFilter = document.getElementById('typeFilter').value;
      const deviceFilter = document.getElementById('deviceFilter').value;
      const uniqueFilter = document.getElementById('uniqueFilter').value;
      const sourceFilter = document.getElementById('sourceFilter').value;

      // –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–∏–µ IP —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ
      const ipCounts = {};
      allData.forEach(item => {
        if (item.ip && item.ip !== 'Unknown') {
          ipCounts[item.ip] = (ipCounts[item.ip] || 0) + 1;
        }
      });

      filteredData = allData.filter(item => {
        const countryMatch = !countryFilter || item.country === countryFilter;
        const typeMatch = !typeFilter || item.type === typeFilter;
        const deviceMatch = !deviceFilter || item.deviceType === deviceFilter;
        const sourceMatch = !sourceFilter || item.source === sourceFilter;

        let uniqueMatch = true;
        if (uniqueFilter === 'unique') {
          uniqueMatch = ipCounts[item.ip] === 1;
        } else if (uniqueFilter === 'repeat') {
          uniqueMatch = ipCounts[item.ip] > 1;
        }

        return countryMatch && typeMatch && deviceMatch && sourceMatch && uniqueMatch;
      });

      renderTable();
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
    function renderTable() {
      const tbody = document.getElementById('logTableBody');

      if (filteredData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="10" class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td></tr>';
        return;
      }

      const rows = filteredData
        .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
        .map(item => {
          const date = new Date(item.timestamp);
          const timeStr = date.toLocaleString('ru-RU');
          const flag = getCountryFlag(item.countryCode);

          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ—Ç–∞–ª–µ–π —Å–æ–±—ã—Ç–∏—è
          let details = item.details || '';
          try {
            const parsedDetails = JSON.parse(details);
            if (typeof parsedDetails === 'object') {
              if (parsedDetails.elementText) {
                details = parsedDetails.elementText;
              } else if (parsedDetails.isUniqueVisitor !== undefined) {
                details = parsedDetails.isUniqueVisitor ? '–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤–∏–∑–∏—Ç' : `–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–∏–∑–∏—Ç (${parsedDetails.totalVisitsFromThisIP})`;
              } else {
                details = Object.entries(parsedDetails).map(([k, v]) => `${k}: ${v}`).join(', ');
              }
            }
          } catch (e) {
            // –ï—Å–ª–∏ –Ω–µ JSON, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
          }

          // –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –µ–≥–æ –∫–ª–∞—Å—Å
          const source = item.referrer || item.source || 'Unknown';
          let sourceClass = 'source-unknown';

          if (source === '–ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥') {
            sourceClass = 'source-direct';
          } else if (source.includes('Google') || source.includes('Yandex') || source.includes('Bing')) {
            sourceClass = 'source-search';
          } else if (source.includes('Facebook') || source.includes('VKontakte') || source.includes('Telegram') || source.includes('Instagram') || source.includes('YouTube') || source.includes('Twitter') || source.includes('TikTok')) {
            sourceClass = 'source-social';
          }

          return `
                        <tr>
                            <td class="ip-cell">${item.ip}</td>
                            <td class="country-cell">
                                <span class="country-flag">${flag}</span>
                                ${item.country}
                            </td>
                            <td>${item.city}</td>
                            <td class="time-cell">${timeStr}</td>
                            <td class="device-${item.deviceType.toLowerCase()}">${item.deviceType}</td>
                            <td>${item.browser}</td>
                            <td class="source-cell ${sourceClass}">${source}</td>
                            <td><span class="action-cell action-${item.type}">${item.type}</span></td>
                            <td>${item.action}</td>
                            <td>${details}</td>
                        </tr>
                    `;
        }).join('');

      tbody.innerHTML = rows;
    }

    // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥—ñ–≤ (—Ç–µ–ø–µ—Ä —Ç–∞–∫–æ–∂ –æ—á–∏—â—É—î —Å–µ—Ä–≤–µ—Ä)
    async function clearLogs() {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.\n\n–≠—Ç–æ –æ—á–∏—Å—Ç–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤–µ–∑–¥–µ - –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –ª–æ–∫–∞–ª—å–Ω–æ!')) {
        try {
          if (!serverConfig.binId) {
            throw new Error('–ù–µ–º–∞—î –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Å–µ—Ä–≤–µ—Ä–∞');
          }

          // –û—á–∏—â—É—î–º–æ —Å–µ—Ä–≤–µ—Ä
          updateSyncStatus('loading', '‚è≥ –û—á–∏—â–µ–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–∞...');

          // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω—ñ –¥–∞–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞
          const response = await fetch(`${serverConfig.baseUrl}/${serverConfig.binId}/latest`, {
            headers: {
              'X-Master-Key': serverConfig.apiKey,
            },
          });

          let currentData = { events: [], metadata: { site: 'aviamasters' } };
          if (response.ok) {
            const result = await response.json();
            currentData = result.record || currentData;
          }

          // –í–∏–¥–∞–ª—è—î–º–æ —Ç—ñ–ª—å–∫–∏ –ø–æ–¥—ñ—ó –Ω–∞—à–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É
          const otherProjectEvents = (currentData.events || []).filter(event =>
            event.projectId !== serverConfig.projectId
          );

          const updatedData = {
            ...currentData,
            events: otherProjectEvents,
            lastUpdated: new Date().toISOString(),
            totalEvents: otherProjectEvents.length
          };

          const updateResponse = await fetch(`${serverConfig.baseUrl}/${serverConfig.binId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'X-Master-Key': serverConfig.apiKey,
            },
            body: JSON.stringify(updatedData),
          });

          if (updateResponse.ok) {
            console.log('‚úÖ –°–µ—Ä–≤–µ—Ä –æ—á–∏—â–µ–Ω');
          } else {
            console.warn('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä');
          }

          // –û—á–∏—â—É—î–º–æ –ª–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ
          localStorage.removeItem('gameAnalytics');
          localStorage.removeItem('gameDailyCounter');
          localStorage.removeItem('gameUniqueVisitor');
          localStorage.removeItem('gameFailedSyncs');

          allData = [];
          filteredData = [];
          updateStats();
          renderTable();
          updateCountryFilter();
          updateSyncStatus('success', '‚úÖ –û—á–∏—â–µ–Ω–æ');
          alert('–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö!');
        } catch (error) {
          console.error('–ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è:', error);
          updateSyncStatus('error', '‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è');
          alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ª–æ–≥–æ–≤');
        }
      }
    }

    // –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
    function downloadCSV() {
      if (filteredData.length === 0) {
        alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
        return;
      }

      const headers = ['IP', '–°—Ç—Ä–∞–Ω–∞', '–ì–æ—Ä–æ–¥', '–í—Ä–µ–º—è', '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', '–ë—Ä–∞—É–∑–µ—Ä', '–ò—Å—Ç–æ—á–Ω–∏–∫', '–¢–∏–ø', '–î–µ–π—Å—Ç–≤–∏–µ', '–î–µ—Ç–∞–ª–∏'];
      const csvContent = [
        headers.join(','),
        ...filteredData.map(item => [
          item.ip,
          item.country,
          item.city,
          new Date(item.timestamp).toLocaleString('ru-RU'),
          item.deviceType,
          item.browser,
          item.source,
          item.type,
          item.action,
          item.details
        ].map(field => `"${field}"`).join(','))
      ].join('\n');

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `aviamasters-analytics-${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
    function downloadJSON() {
      if (allData.length === 0) {
        alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
        return;
      }

      const exportData = {
        exportDate: new Date().toISOString(),
        projectId: serverConfig.projectId,
        totalRecords: allData.length,
        data: allData
      };

      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `aviamasters-analytics-${new Date().toISOString().split('T')[0]}.json`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    function refreshData() {
      loadData();
    }

    // –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
    function exportAllData() {
      if (allData.length === 0) {
        alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
        return;
      }

      const exportData = {
        exportDate: new Date().toISOString(),
        totalRecords: allData.length,
        data: allData
      };

      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `aviamasters-analytics-all-${new Date().toISOString().split('T')[0]}.json`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
    function importData() {
      const file = document.getElementById('importFile').files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const importedData = JSON.parse(e.target.result);
            let dataToImport = [];

            if (importedData.data && Array.isArray(importedData.data)) {
              dataToImport = importedData.data;
            } else if (Array.isArray(importedData)) {
              dataToImport = importedData;
            }

            allData = dataToImport.map(item => ({
              ...item,
              ip: item.ip || 'Unknown',
              country: item.country || 'Unknown',
              countryCode: item.countryCode || 'XX',
              city: item.city || 'Unknown',
              deviceType: item.deviceType || 'Unknown',
              browser: item.browser || 'Unknown',
              timestamp: item.timestamp || new Date().toISOString(),
              type: item.type || 'unknown',
              action: item.action || item.eventType || 'visit',
              details: item.details || item.action || '',
              source: item.referrer || item.source || 'Unknown'
            }));
            updateStats();
            updateCountryFilter();
            updateSourceFilter();
            filterTable();
            alert(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${dataToImport.length} –∑–∞–ø–∏—Å–µ–π`);
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:', error);
            alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö');
          }
        };
        reader.readAsText(file);
      }
    }

    // –û—Ç–ª–∞–¥–∫–∞
    function showDebugInfo() {
      console.log('–í—Å–µ –¥–∞–Ω–Ω—ã–µ:', allData);
      console.log('–§–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', filteredData);

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 10000;
        display: flex;
        justify-content: center;
        align-items: center;
      `;

      const content = document.createElement('div');
      content.style.cssText = `
        background: white;
        padding: 20px;
        border-radius: 10px;
        max-width: 80%;
        max-height: 80%;
        overflow: auto;
      `;

      const localStorageData = localStorage.getItem('gameAnalytics');
      const visitedIPs = localStorage.getItem('gameUniqueVisitor');
      const failedSyncs = localStorage.getItem('gameFailedSyncs');
      const lastSync = localStorage.getItem('gameServerSync');

      content.innerHTML = `
        <h2>üîç –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <p><strong>Project ID:</strong> ${serverConfig.projectId || '–ù–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ'}</p>
        <p><strong>Bin ID:</strong> ${serverConfig.binId || '–ù–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ'}</p>
        <p><strong>–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ –ø–∞–º—è—Ç–∏:</strong> ${allData.length}</p>
        <p><strong>–§–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π:</strong> ${filteredData.length}</p>
        <p><strong>–†–∞–∑–º–µ—Ä –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:</strong> ${localStorageData ? localStorageData.length : 0} —Å–∏–º–≤–æ–ª–æ–≤</p>
        <p><strong>–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ IP:</strong> ${visitedIPs ? JSON.parse(visitedIPs).length : 0}</p>
        <p><strong>–ù–µ—É–¥–∞—á–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:</strong> ${failedSyncs ? JSON.parse(failedSyncs).length : 0}</p>
        <p><strong>–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</strong> ${lastSync || '–ù–∏–∫–æ–≥–¥–∞'}</p>
        <br>
        <h3>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞:</h3>
        <p><strong>Base URL:</strong> ${serverConfig.baseUrl}</p>
        <br>
        <h3>–õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</h3>
        <textarea style="width: 100%; height: 150px;" readonly>${localStorageData || '–ü—É—Å—Ç–æ'}</textarea>
        <br><br>
        <h3>–ù–µ—É–¥–∞—á–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:</h3>
        <textarea style="width: 100%; height: 100px;" readonly>${failedSyncs || '–ü—É—Å—Ç–æ'}</textarea>
        <br><br>
        <button onclick="this.parentElement.parentElement.remove()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">–ó–∞–∫—Ä—ã—Ç—å</button>
      `;

      modal.appendChild(content);
      document.body.appendChild(modal);
    }

    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(loadData, 30000);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', loadData);
  </script>
</body>

</html>